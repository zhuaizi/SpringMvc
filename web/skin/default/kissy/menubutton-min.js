KISSY.add("menubutton/menubutton-xtpl",["component/extension/content-xtpl"],function(d,b,a,c){return function(f,i,j){var r="",y=this.config,x=this,g,v=y.utils;if(typeof c!=="undefined"&&c.kissy){g=c}var m=v.runBlockCommand,n=v.renderOutput,o=v.getProperty,l=v.runInlineCommand,k=v.getPropertyOrRunCommand;r+="";var w={};var t=[];t.push("component/extension/content-xtpl");w.params=t;if(g){b("component/extension/content-xtpl");w.params[0]=g.resolveByName(w.params[0])}var h=l(x,f,w,"include",1);r+=n(h,false);r+='\n<div class="';var u={};var q=[];q.push("dropdown");u.params=q;var e=l(x,f,u,"getBaseCssClasses",2);r+=n(e,true);r+='">\n    <div class="';var s={};var p=[];p.push("dropdown-inner");s.params=p;var z=l(x,f,s,"getBaseCssClasses",3);r+=n(z,true);r+='">\n    </div>\n</div>';return r}});KISSY.add("menubutton/render",["button","./menubutton-xtpl","component/extension/content-render"],function(c,b){var a=b("button");var e=b("./menubutton-xtpl");var d=b("component/extension/content-render");return a.getDefaultRender().extend([d],{decorateDom:function(i){var j=this.control,g=j.get("prefixCls");var f=i.one("."+g+"popupmenu");var h=f[0].ownerDocument.body;h.insertBefore(f[0],h.firstChild);var k=this.getComponentConstructorByNode(g,f);j.setInternal("menu",new k({srcNode:f,prefixCls:g}))},beforeCreateDom:function(f){c.mix(f.elAttrs,{"aria-expanded":false,"aria-haspopup":true})},_onSetCollapsed:function(h){var g=this,i=g.$el,f=g.getBaseCssClass("open");i[h?"removeClass":"addClass"](f).attr("aria-expanded",!h)}},{ATTRS:{contentTpl:{value:e}}})});KISSY.add("menubutton/control",["node","button","./render"],function(e,d){var c=d("node");var b=d("button");var h=d("./render");var f=c.KeyCode;return b.extend({isMenuButton:1,_onSetCollapsed:function(k){var j=this,n=j.get("menu");if(k){n.hide()}else{var m=j.$el;if(!n.get("visible")){var o={node:m,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};e.mix(n.get("align"),o,false);if(j.get("matchElWidth")){n.render();var l=n.get("el");var i=0;if(j.get("borderWidth")){i=(parseInt(l.css("borderLeftWidth"))||0)+(parseInt(l.css("borderRightWidth"))||0)}n.set("width",n.get("align").node[0].offsetWidth-i)}n.show();m.attr("aria-haspopup",n.get("el").attr("id"))}}},bindUI:function(){var i=this;i.on("afterHighlightedItemChange",a,i);i.on("click",g,i)},handleKeyDownInternal:function(m){var i=this,l=m.keyCode,j=String(m.type),n=i.get("menu");if(l===f.SPACE){m.preventDefault();if(j!=="keyup"){return undefined}}else{if(j!=="keydown"){return undefined}}if(n.get("rendered")&&n.get("visible")){var k=n.handleKeyDownInternal(m);if(l===f.ESC){i.set("collapsed",true);return true}return k}if(l===f.SPACE||l===f.DOWN||l===f.UP){i.set("collapsed",false);return true}return undefined},handleClickInternal:function(){var i=this;i.set("collapsed",!i.get("collapsed"))},handleBlurInternal:function(j){var i=this;i.callSuper(j);i.set("collapsed",true)},addItem:function(j,i){var k=this.get("menu");k.addChild(j,i)},removeItem:function(k,i){var j=this.get("menu");j.removeChild(k,i)},removeItems:function(i){var j=this.get("menu");if(j){if(j.removeChildren){j.removeChildren(i)}else{if(j.children){j.children=[]}}}},getItemAt:function(i){var j=this.get("menu");return j.get("rendered")&&j.getChildAt(i)},_onSetDisabled:function(i){if(!i){this.set("collapsed",true)}},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:true},collapseOnClick:{value:false},menu:{value:{},getter:function(i){if(!i.isControl){i.xclass=i.xclass||"popupmenu";i=this.createComponent(i);this.setInternal("menu",i)}return i},setter:function(i){if(i.isControl){i.setInternal("parent",this)}}},collapsed:{value:false,view:1},xrender:{value:h}},xclass:"menu-button"});function g(i){if(i.target.isMenuItem&&this.get("collapseOnClick")){this.set("collapsed",true)}}function a(k){if(k.target.isMenu){var j=this.el,i=k.newVal;j.setAttribute("aria-activedescendant",i&&i.el.id||"")}}});KISSY.add("menubutton/select",["node","./control"],function(c,b){var e=b("node");var f=b("./control");function g(l){var p=l.get("menu"),n=p.children||p.get&&p.get("children")||[],o=l.get("value"),q,m;for(m=0;m<n.length;m++){q=n[m];if(j(q)==o){return q}}return null}function j(m){var l;if(m){if(m.get){if((l=m.get("value"))===undefined){l=m.get("textContent")||m.get("content")}}else{if((l=m.value)===undefined){l=m.textContent||m.content}}}return l}function d(l){var o=l.get("menu"),n=l.get("value"),m=o&&o.get&&o.get("children");c.each(m,function(p){if(p&&p.set){p.set("selected",j(p)===n)}})}function i(q){var n=this,p=g(n),l=n.get("menu");if(q.target===l){var o=p||l.getChildAt(0);if(o){o.set("highlighted",true)}if(p){p.set("selected",true)}}}function h(l){var o=g(l),n=o&&(o.textContent||o.get&&o.get("textContent")),m=o&&(o.content||o.get&&o.get("content"));l.set("content",n||m||l.get("defaultCaption"))}function k(p){var l=this,o=p.target;if(o.isMenuItem){var n=j(o),m=l.get("value");l.set("value",n);if(n!==m){l.fire("change",{prevVal:m,newVal:n})}}}var a=f.extend({bindUI:function(){this.on("click",k,this);this.on("show",i,this)},removeItems:function(){var l=this;l.callSuper.apply(l,arguments);l.set("value",null)},removeItem:function(n,m){var l=this;l.callSuper(n,m);if(n.get("value")===l.get("value")){l.set("value",null)}},_onSetValue:function(){var l=this;d(l);h(l)},_onSetDefaultCaption:function(){h(this)}},{ATTRS:{value:{},nameid:{value:false},defaultCaption:{value:""},collapseOnClick:{value:true}},decorate:function(s,t){s=c.one(s);t=t||{};t.elBefore=s;var m,u=[],w,o=null,q=s.val(),y=s.all("option");y.each(function(z){var A={xclass:"option",content:z.text(),elCls:z.attr("class"),value:z.val()};if(q===z.val()){o={content:A.content,value:A.value}}u.push(A)});t.menu=t.menu||t.menuCfg||{};t.menu.children=u;delete t.menuCfg;w=(new a(c.mix(t,o))).render();if(m=s.attr("name")){var l=m;m=l+"_txt";if(w.get("nameid")){m=l;l=l+"_id"}var v=(new e('<input type="hidden" name="'+l+'" value="'+q+'">')).insertBefore(s,undefined);var r="";if(o){r=o.content}var x=s.attr("data-rules");if(x){x=' data-rules="'+x+'"'}else{x=""}var n=s.attr("data-msg");if(n){n=' data-msg="'+n+'"'}else{n=""}var p=(new e('<input type="hidden" name="'+m+'" '+x+n+' value="'+r+'">')).insertBefore(s,undefined);w.on("afterValueChange",function(A){v.val(A.newVal||"");var z=A.target;p.val(z.get("content")||"")})}s.remove();return w},xclass:"select"});return a});KISSY.add("menubutton/option",["menu"],function(b,a){var d=a("menu");var c=d.Item;return c.extend({},{ATTRS:{selectable:{value:true},textContent:{}},xclass:"option"})});KISSY.add("menubutton",["menubutton/control","menubutton/select","menubutton/option"],function(c,a){var e=a("menubutton/control");var d=a("menubutton/select");var b=a("menubutton/option");e.Select=d;e.Option=b;return e});
