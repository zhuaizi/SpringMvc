KISSY.add("io/form-serializer",["dom"],function(e,d){var g=d("dom");var b=/^(?:select|textarea)/i,f=/\r?\n/g,h,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;function c(i){return i.replace(f,"\r\n")}h={serialize:function(j,i){return e.param(h.getFormData(j),undefined,undefined,i||false)},getFormData:function(i){var k=[],j={};e.each(g.query(i),function(m){var l=m.elements?e.makeArray(m.elements):[m];k.push.apply(k,l)});k=e.filter(k,function(l){return l.name&&!l.disabled&&(l.checked||b.test(l.nodeName)||a.test(l.type))});e.each(k,function(l){var m=g.val(l),n;if(m===null){return}if(e.isArray(m)){m=e.map(m,c)}else{m=c(m)}n=j[l.name];if(n===undefined){j[l.name]=m;return}if(!e.isArray(n)){n=j[l.name]=[n]}n.push.apply(n,e.makeArray(m))});return j}};return h});KISSY.add("io/base",["event/custom","promise"],function(f,c){var o=c("event/custom"),j=c("promise");var l=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,p=/\s+/,k=function(q){return q},m=/^(?:GET|HEAD)$/,h=f.Env.host,n=h.location||{},b=new f.Uri(n.href),i=b&&l.test(b.getScheme()),d={},e={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parseJson,html:k,text:k,xml:f.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest","Client-Type":"Ext"},contents:{xml:/xml/,html:/html/,json:/json/}};e.converters.html=e.converters.text;function g(v){var r=v.context;delete v.context;v=f.mix(f.clone(e),v,{deep:true});v.context=r||v;var u,t,s=v.type,q=v.dataType;t=v.uri=b.resolve(v.url);v.uri.setQuery("");if(!("crossDomain" in v)){v.crossDomain=!v.uri.isSameOriginAs(b)}s=v.type=s.toUpperCase();v.hasContent=!m.test(s);if(v.processData&&(u=v.data)&&typeof u!=="string"){v.data=f.param(u,undefined,undefined,v.serializeArray)}q=v.dataType=f.trim(q||"*").split(p);if(!("cache" in v)&&f.inArray(q[0],["script","jsonp"])){v.cache=false}if(!v.hasContent){if(v.data){t.query.add(f.unparam(v.data))}if(v.cache===false){t.query.set("_ksTS",f.now()+"_"+f.guid())}}return v}function a(x){var A=this;if(!(A instanceof a)){return new a(x)}j.call(A);x=g(x);f.mix(A,{responseData:null,config:x||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});j.Defer(A);var r,u;a.fire("start",{ajaxConfig:x,io:A});r=d[x.dataType[0]]||d["*"];u=new r(A);A.transport=u;if(x.contentType){A.setRequestHeader("Content-Type",x.contentType)}var z=x.dataType[0],v,y=x.timeout,s=x.context,t=x.headers,q=x.accepts;A.setRequestHeader("Accept",z&&q[z]?q[z]+(z==="*"?"":", */*; q=0.01"):q["*"]);for(v in t){A.setRequestHeader(v,t[v])}if(x.beforeSend&&x.beforeSend.call(s,A,x)===false){return A}A.readyState=1;a.fire("send",{ajaxConfig:x,io:A});if(x.async&&y>0){A.timeoutTimer=setTimeout(function(){A.abort("timeout")},y*1000)}try{A.state=1;u.send()}catch(w){if(A.state<2){f.log(w.stack||w,"error");if("@DEBUG@"){setTimeout(function(){throw w},0)}A._ioReady(-1,w.message||"send error")}else{f.error(w)}}return A}f.mix(a,o.Target);f.mix(a,{isLocal:i,setupConfig:function(q){f.mix(e,q,{deep:true})},setupTransport:function(q,r){d[q]=r},getTransport:function(q){return d[q]},getConfig:function(){return e}});return a});KISSY.add("io/xhr-transport-base",["./base"],function(g,k){var d=k("./base");var r=g.getLogger("s/io");var p=200,f=g.Env.host,n=g.UA.ieMode>7&&f.XDomainRequest,b=204,h=404,c=1223,q={proto:{}},a={},o={};d.__lastModifiedCached=a;d.__eTagCached=o;function e(s,t){try{return new (t||f).XMLHttpRequest}catch(u){}return undefined}function m(s,t){try{return new (t||f).ActiveXObject("Microsoft.XMLHTTP")}catch(u){}return undefined}q.nativeXhr=f.ActiveXObject?function(t,s){if(!l&&t&&n){return new n}return !d.isLocal&&e(t,s)||m(t,s)}:e;q.XDomainRequest_=n;var l=q.supportCORS="withCredentials" in q.nativeXhr();function i(s){return n&&s instanceof n}function j(u){var t=u.ifModified,s;if(t){s=u.uri;if(u.cache===false){s=s.clone();s.query.remove("_ksTS")}s=s.toString()}return s}g.mix(q.proto,{sendInternal:function(){var C=this,y=C.io,K=y.config,G=C.nativeXhr,x=K.files,s=x?"post":K.type,v=K.async,t,w=y.mimeType,E=y.requestHeaders||{},u=y._getUrlForSend(),J,B=j(K),D,H;if(B){if(D=a[B]){E["If-Modified-Since"]=D}if(D=o[B]){E["If-None-Match"]=D}}if(t=K.username){G.open(s,u,v,t,K.password)}else{G.open(s,u,v)}J=K.xhrFields||{};if("withCredentials" in J){if(!l){delete J.withCredentials}}for(H in J){try{G[H]=J[H]}catch(I){r.error(I)}}if(w&&G.overrideMimeType){G.overrideMimeType(w)}var z=E["X-Requested-With"];if(z===false){delete E["X-Requested-With"]}if(typeof G.setRequestHeader!=="undefined"){for(H in E){G.setRequestHeader(H,E[H])}}var A=K.hasContent&&K.data||null;if(x){var F=A,L={};if(F){L=g.unparam(F)}L=g.mix(L,x);A=new FormData;g.each(L,function(N,M){if(g.isArray(N)){g.each(N,function(O){A.append(M+(K.serializeArray?"[]":""),O)})}else{A.append(M,N)}})}G.send(A);if(!v||G.readyState===4){C._callback()}else{if(i(G)){G.onload=function(){G.readyState=4;G.status=200;C._callback()};G.onerror=function(){G.readyState=4;G.status=500;C._callback()}}else{G.onreadystatechange=function(){C._callback()}}}},abort:function(){this._callback(0,1)},_callback:function(s,y){var H=this,E=H.nativeXhr,C=H.io,t,w,F,v,z,D=C.config;try{if(y||E.readyState===4){if(i(E)){E.onerror=g.noop;E.onload=g.noop}else{E.onreadystatechange=g.noop}if(y){if(E.readyState!==4){E.abort()}}else{t=j(D);var x=E.status;if(!i(E)){C.responseHeadersString=E.getAllResponseHeaders()}if(t){w=E.getResponseHeader("Last-Modified");F=E.getResponseHeader("ETag");if(w){a[t]=w}if(F){o[F]=F}}z=E.responseXML;if(z&&z.documentElement){C.responseXML=z}var G=C.responseText=E.responseText;if(D.files&&G){var u,A;if((u=G.indexOf("<body>"))!==-1){A=G.lastIndexOf("</body>");if(A===-1){A=G.length}G=G.slice(u+6,A)}C.responseText=g.unEscapeHtml(G)}try{v=E.statusText}catch(B){r.error("xhr statusText error: ");r.error(B);v=""}if(!x&&d.isLocal&&!D.crossDomain){x=C.responseText?p:h}else{if(x===c){x=b}}C._ioReady(x,v)}}}catch(B){g.log(B.stack||B,"error");if("@DEBUG@"){setTimeout(function(){throw B},0)}E.onreadystatechange=g.noop;if(!y){C._ioReady(-1,B.message||"process error")}}}});return q});KISSY.add("io/xdr-flash-transport",["./base","dom"],function(e,b){var a=b("./base"),f=b("dom");var k=e.getLogger("s/io");var i={},h="io_swf",g,j=e.Env.host.document,l=false;function d(p,m,n){if(l){return}l=true;var q='<object id="'+h+'" type="application/x-shockwave-flash" data="'+p+'" width="0" height="0"><param name="movie" value="'+p+'" /><param name="FlashVars" value="yid='+m+"&uid="+n+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',r=j.createElement("div");f.prepend(r,j.body||j.documentElement);r.innerHTML=q}function c(m){k.info("use XdrFlashTransport for: "+m.config.url);this.io=m}e.augment(c,{send:function(){var n=this,p=n.io,o=p.config,m=o.xdr||{};d(m.src||e.Config.base+"io/assets/io.swf",1,1);if(!g){setTimeout(function(){n.send()},200);return}n._uid=e.guid();i[n._uid]=n;g.send(p._getUrlForSend(),{id:n._uid,uid:n._uid,method:o.type,data:o.hasContent&&o.data||{}})},abort:function(){g.abort(this._uid)},_xdrResponse:function(q,r){var m=this,n,u=r.id,p,t=r.c,s=m.io;if(t&&(p=t.responseText)){s.responseText=decodeURI(p)}switch(q){case"success":n={status:200,statusText:"success"};delete i[u];break;case"abort":delete i[u];break;case"timeout":case"transport error":case"failure":delete i[u];n={status:"status" in t?t.status:500,statusText:t.statusText||q};break}if(n){s._ioReady(n.status,n.statusText)}}});a.applyTo=function(o,q,n){var m=q.split(".").slice(1),p=a;e.each(m,function(r){p=p[r]});p.apply(null,n)};a.xdrReady=function(){g=j.getElementById(h)};a.xdrResponse=function(m,p){var n=i[p.uid];if(n){n._xdrResponse(m,p)}};return c});KISSY.add("io/sub-domain-transport",["event/dom","dom","./xhr-transport-base"],function(d,b){var i=b("event/dom"),e=b("dom"),c=b("./xhr-transport-base");var k=d.getLogger("s/io");var g="/sub_domain_proxy.html",h=d.Env.host.document,j={};function f(n){var l=this,m=n.config;l.io=n;m.crossDomain=false;k.info("use SubDomainTransport for: "+m.url)}d.augment(f,c.proto,{send:function(){var m=this,s=m.io.config,q=s.uri,l=q.getHostname(),p,r,o=j[l];var n=g;if(s.xdr&&s.xdr.subDomain&&s.xdr.subDomain.proxy){n=s.xdr.subDomain.proxy}if(o&&o.ready){m.nativeXhr=c.nativeXhr(0,o.iframe.contentWindow);if(m.nativeXhr){m.sendInternal()}else{d.error("document.domain not set correctly!")}return}if(!o){o=j[l]={};p=o.iframe=h.createElement("iframe");e.css(p,{position:"absolute",left:"-9999px",top:"-9999px"});e.prepend(p,h.body||h.documentElement);r=new d.Uri;r.setScheme(q.getScheme());r.setPort(q.getPort());r.setHostname(l);r.setPath(n);p.src=r.toString()}else{p=o.iframe}i.on(p,"load",a,m)}});function a(){var m=this,p=m.io.config,o=p.uri,l=o.getHostname(),n=j[l];n.ready=1;i.detach(n.iframe,"load",a,m);m.send()}return f});KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(g,d){var c=d("./base"),f=d("./xhr-transport-base"),e=d("./xdr-flash-transport"),i=d("./sub-domain-transport");var l=g.getLogger("s/io");var j=g.Env.host,k=j.document,b=f.XDomainRequest_;function h(m){return k.domain&&g.endsWith(m,k.domain)}function a(t){var s=t.config,p=s.crossDomain,m=this,r,o=s.xdr||{},n=o.subDomain=o.subDomain||{};m.io=t;if(p&&!f.supportCORS){if(h(s.uri.getHostname())){if(n.proxy!==false){return new i(t)}}if(String(o.use)==="flash"||!b){return new e(t)}}r=m.nativeXhr=f.nativeXhr(p);var q="crossDomain: "+p+", use "+(b&&r instanceof b?"XDomainRequest":"XhrTransport")+" for: "+s.url;l.debug(q);return m}g.augment(a,f.proto,{send:function(){this.sendInternal()}});c.setupTransport("*",a);return c});KISSY.add("io/script-transport",["./base"],function(g,e){var b=e("./base");var d=g.getLogger("s/io");var f=200,c=500;b.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(h){g.globalEval(h);return h}}}});function a(j){var i=j.config,h=this;if(!i.crossDomain){return new (b.getTransport("*"))(j)}h.io=j;d.info("use ScriptTransport for: "+i.url);return h}g.augment(a,{send:function(){var h=this,j=h.io,i=j.config;h.script=g.getScript(j._getUrlForSend(),{charset:i.scriptCharset,success:function(){h._callback("success")},error:function(){h._callback("error")}})},_callback:function(j,l){var i=this,h=i.script,k=i.io;if(!h){return}i.script=undefined;if(l){return}if(j!=="error"){k._ioReady(f,"success")}else{if(j==="error"){k._ioReady(c,"script error")}}},abort:function(){this._callback(0,1)}});b.setupTransport("script",a);return b});KISSY.add("io/jsonp",["./base"],function(c,b){var a=b("./base");var d=c.Env.host;a.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});a.on("start",function(j){var k=j.io,l=k.config,m=l.dataType;if(m[0]==="jsonp"){delete l.contentType;var g,h=l.jsonpCallback,n,f=typeof h==="function"?h():h,i=d[f];l.uri.query.set(l.jsonp,f);d[f]=function(e){if(arguments.length>1){e=c.makeArray(arguments)}g=[e]};k.fin(function(){d[f]=i;if(i===undefined){try{delete d[f]}catch(o){}}else{if(g){i(g[0])}}});n=l.converters;n.script=n.script||{};n.script.json=function(){if(!g){throw new Error("not call jsonpCallback: "+f)}return g[0]};m.length=2;m[0]="script";m[1]="json"}});return a});KISSY.add("io/form",["./base","dom","./form-serializer"],function(c,b){var a=b("./base");var d=b("dom");var e=b("./form-serializer");var f=c.Env.host,h=Array.prototype.slice,g=f.FormData;a.on("start",function(u){var v=u.io,m,w,z,q,r,x=v.config,k=x.form;if(k){m=d.get(k);r=x.data;var t=false;var j={};var s=d.query("input",m);for(var p=0,n=s.length;p<n;p++){var y=s[p];if(y.type.toLowerCase()==="file"){t=true;if(!g){break}var o=h.call(y.files,0);j[d.attr(y,"name")]=o.length>1?o:o[0]||null}}if(t&&g){x.files=x.files||{};c.mix(x.files,j);delete x.contentType}if(!t||g){q=e.getFormData(m);if(x.hasContent){q=c.param(q,undefined,undefined,x.serializeArray);if(r){x.data+="&"+q}else{x.data=q}}else{x.uri.query.add(q)}}else{z=x.dataType;w=z[0];if(w==="*"){w="text"}z.length=2;z[0]="iframe";z[1]=w}}});return a});KISSY.add("io/iframe-transport",["dom","./base","event/dom"],function(e,c){var f=c("dom"),a=c("./base"),l=c("event/dom");var m=e.getLogger("s/io");var j=e.Env.host.document,h=200,o=500,k=30,n=e.clone(a.getConfig().converters.text);n.json=function(p){return e.parseJson(e.unEscapeHtml(p))};a.setupConfig({converters:{iframe:n,text:{iframe:function(p){return p}},xml:{iframe:function(p){return p}}}});function i(r){var s=e.guid("io-iframe"),p,q=f.getEmptyIframeSrc();p=r.iframe=f.create("<iframe "+(q?' src="'+q+'" ':"")+' id="'+s+'" name="'+s+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(p,j.body||j.documentElement);return p}function g(u,t,p){var r=[],q,w,s,v;e.each(u,function(y,x){q=e.isArray(y);w=e.makeArray(y);for(s=0;s<w.length;s++){v=j.createElement("input");v.type="hidden";v.name=x+(q&&p?"[]":"");v.value=w[s];f.append(v,t);r.push(v)}});return r}function b(p){f.remove(p)}function d(p){this.io=p;m.info("use IframeTransport for: "+p.config.url)}e.augment(d,{send:function(){var x=this,u=x.io,v=u.config,t,r,w,s=v.data,p=f.get(v.form);x.attrs={target:f.attr(p,"target")||"",action:f.attr(p,"action")||"",encoding:f.attr(p,"encoding"),enctype:f.attr(p,"enctype"),method:f.attr(p,"method")};x.form=p;r=i(u);f.attr(p,{target:r.id,action:u._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});if(s){w=e.unparam(s)}if(w){t=g(w,p,v.serializeArray)}x.fields=t;function q(){l.on(r,"load error",x._callback,x);p.submit()}if(e.UA.ie===6){setTimeout(q,0)}else{q()}},_callback:function(t){var p=this,s=p.form,w=p.io,q=t.type,v,r=w.iframe;if(!r){return}if(q==="abort"&&e.UA.ie===6){setTimeout(function(){f.attr(s,p.attrs)},0)}else{f.attr(s,p.attrs)}b(this.fields);l.detach(r);setTimeout(function(){f.remove(r)},k);w.iframe=null;if(q==="load"){try{v=r.contentWindow.document;if(v&&v.body){w.responseText=f.html(v.body);if(e.startsWith(w.responseText,"<?xml")){w.responseText=undefined}}if(v&&v.XMLDocument){w.responseXML=v.XMLDocument}else{w.responseXML=v}if(v){w._ioReady(h,"success")}else{w._ioReady(o,"parser error")}}catch(u){w._ioReady(o,"parser error")}}else{if(q==="error"){w._ioReady(o,"error")}}},abort:function(){this._callback({type:"abort"})}});a.setupTransport("iframe",d);return a});KISSY.add("io/methods",["promise","./base"],function(e,c){var h=c("promise"),a=c("./base");var f=200,i=300,b=304,g=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;function d(r){var w=r.responseText,p=r.responseXML,s=r.config,x=s.converters,t,v,k,l=s.contents,u=s.dataType;if(w||p){v=r.mimeType||r.getResponseHeader("Content-Type");while(u[0]==="*"){u.shift()}if(!u.length){for(t in l){if(l[t].test(v)){if(u[0]!==t){u.unshift(t)}break}}}u[0]=u[0]||"text";for(var n=0;n<u.length;n++){if(u[n]==="text"&&w!==undefined){k=w;break}else{if(u[n]==="xml"&&p!==undefined){k=p;break}}}if(!k){var j={text:w,xml:p};e.each(["text","xml"],function(y){var A=u[0],z=x[y]&&x[y][A];if(z&&j[y]){u.unshift(y);k=y==="text"?w:p;return false}return undefined})}}var q=u[0];for(var o=1;o<u.length;o++){t=u[o];var m=x[q]&&x[q][t];if(!m){throw new Error("no covert for "+q+" => "+t)}k=m(k);q=t}r.responseData=k}e.extend(a,h,{setRequestHeader:function(k,l){var j=this;j.requestHeaders[k]=l;return j},getAllResponseHeaders:function(){var j=this;return j.state===2?j.responseHeadersString:null},getResponseHeader:function(l){var k,j=this,m;l=l.toLowerCase();if(j.state===2){if(!(m=j.responseHeaders)){m=j.responseHeaders={};while(k=g.exec(j.responseHeadersString)){m[k[1].toLowerCase()]=k[2]}}k=m[l]}return k===undefined?null:k},overrideMimeType:function(k){var j=this;if(!j.state){j.mimeType=k}return j},abort:function(k){var j=this;k=k||"abort";if(j.transport){j.transport.abort(k)}j._ioReady(0,k);return j},getNativeXhr:function(){var j=this.transport;if(j){return j.nativeXhr}return null},_ioReady:function(p,m){var w=this;if(w.state===2){return}w.state=2;w.readyState=4;var l;if(p>=f&&p<i||p===b){if(p===b){m="not modified";l=true}else{try{d(w);m="success";l=true}catch(r){e.log(r.stack||r,"error");if("@DEBUG@"){setTimeout(function(){throw r},0)}m=r.message||"parser error"}}}else{if(p<0){p=0}}w.status=p;w.statusText=m;var j=w.defer,n=w.config,s;if(s=w.timeoutTimer){clearTimeout(s);w.timeoutTimer=0}var u=l?"success":"error",q,t=[w.responseData,m,w],k=n.context,o={ajaxConfig:n,io:w};if(q=n[u]){q.apply(k,t)}if(q=n.complete){q.apply(k,t)}a.fire(u,o);a.fire("complete",o);j[l?"resolve":"reject"](t)},_getUrlForSend:function(){var m=this.config,l=m.uri,j=e.Uri.getComponents(m.url).query||"",k=l.toString.call(l,m.serializeArray);return k+(j?(l.query.has()?"&":"?")+j:j)}})});KISSY.add("io",["io/form-serializer","io/base","io/xhr-transport","io/script-transport","io/jsonp","io/form","io/iframe-transport","io/methods"],function(d,c){var e=c("io/form-serializer"),a=c("io/base");c("io/xhr-transport");c("io/script-transport");c("io/jsonp");c("io/form");c("io/iframe-transport");c("io/methods");function b(g,i,j,f,h){if(typeof i==="function"){f=j;j=i;i=undefined}return a({type:h||"get",url:g,data:i,success:j,dataType:f})}d.mix(a,{serialize:e.serialize,get:b,post:function(g,h,i,f){if(typeof h==="function"){f=i;i=h;h=undefined}return b(g,h,i,f,"post")},jsonp:function(f,g,h){if(typeof g==="function"){h=g;g=undefined}return b(f,g,h,"jsonp")},getScript:d.getScript,getJSON:function(f,g,h){if(typeof g==="function"){h=g;g=undefined}return b(f,g,h,"json")},upload:function(g,h,i,j,f){if(typeof i==="function"){f=j;j=i;i=undefined}return a({url:g,type:"post",dataType:f,form:h,data:i,success:j})}});d.mix(d,{Ajax:a,IO:a,ajax:a,io:a,jsonp:a.jsonp});return a});
